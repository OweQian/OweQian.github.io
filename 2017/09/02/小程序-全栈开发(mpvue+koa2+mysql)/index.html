
<!DOCTYPE html>
<html lang="" class="loading">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>小程序-全栈开发(mpvue+koa2+mysql) - W | 个人博客 | web前端</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="OweQian,"> 
    <meta name="description" content="前端,导语
接触小程序并做了一些项目之后，又开始了Vue的旅程，受其核心思想的影响，对数据/状态管理、组件化、跨平台等都有较高的追求，mpvue 是一个使用 Vue.js开发小程序的前端框架，由此开始了m,"> 
    <meta name="author" content="wangxiaobai"> 
    <link rel="alternative" href="atom.xml" title="W | 个人博客 | web前端" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.ico"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body class="loading">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><span id="config-title" style="display:none">W | 个人博客 | web前端</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" data-url="http://yoursite.com"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">小程序-全栈开发(mpvue+koa2+mysql)</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">小程序-全栈开发(mpvue+koa2+mysql)</h1>
        <div class="stuff">
            <span>九月 02, 2017</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/小程序/">小程序</a></li></ul>


        </div>
        <div class="content markdown">
            <h4 id="导语"><a href="#导语" class="headerlink" title="导语"></a>导语</h4><blockquote>
<p>接触小程序并做了一些项目之后，又开始了Vue的旅程，受其核心思想的影响，对数据/状态管理、组件化、跨平台等都有较高的追求，mpvue 是一个使用 Vue.js开发小程序的前端框架，由此开始了mpvue踩坑之旅，想在提高代码可读性的同时，也增加一点Vue.js的开发体验。</p>
</blockquote>
<a id="more"></a>
<h3 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h3><hr>
<p>前端： 微信小程序、mpvue、 eslint、sass、ES6、ES7<br>后端：koa2、Koa-Router、Knex、腾讯云Wafer2<br>数据库：Mysql<br>数据库可视化工具：Navicate Premium</p>
<hr>
<h2 id="小程序介绍"><a href="#小程序介绍" class="headerlink" title="小程序介绍"></a>小程序介绍</h2><p>一个功能简单的小程序，包含了个人中心、图书列表、个人评论列表三个tab页，后端的数据定义、分类、和存取等，各有其色。</p>
<hr>
<h3 id="成果分享"><a href="#成果分享" class="headerlink" title="成果分享"></a>成果分享</h3><p>个人中心：</p>
<p><img src="http://ow43yt5wd.bkt.clouddn.com/user1.gif" alt=""></p>
<p>个人中心：</p>
<p><img src="http://ow43yt5wd.bkt.clouddn.com/user2.gif" alt=""></p>
<p>图书列表：</p>
<p><img src="http://ow43yt5wd.bkt.clouddn.com/home1.gif" alt=""></p>
<p>图书详情：</p>
<p><img src="http://ow43yt5wd.bkt.clouddn.com/home1.gif" alt=""></p>
<p>评论列表：</p>
<p><img src="http://ow43yt5wd.bkt.clouddn.com/list-01.gif" alt=""></p>
<hr>
<h3 id="脑图"><a href="#脑图" class="headerlink" title="脑图"></a>脑图</h3><p><img src="http://ow43yt5wd.bkt.clouddn.com/naotu.jpg" alt=""></p>
<hr>
<h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><p>*全局安装vue-cli</p>
<p>$npm install –global vue-cli</p>
<p>*创建基于mpvue-quickstart模板的新项目，一路回车。</p>
<p>$vue init mpvue/mpvue-quickstart koa-wx</p>
<p>*安装依赖</p>
<p>$cd koa-wx</p>
<p>$npm install</p>
<p>$npm run dev</p>
<hr>
<h3 id="项目目录"><a href="#项目目录" class="headerlink" title="项目目录"></a>项目目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">├── build           // 构建相关  </div><div class="line">├── config           // 配置相关</div><div class="line">├── dist            // 编译后静态文件 </div><div class="line">├── node_modules        // 依赖相关</div><div class="line">├── server            // 服务端源代码</div><div class="line">│  ├── controllers     </div><div class="line">│  ├── middlewares    </div><div class="line">│  ├── node_modules    </div><div class="line">│  ├── routes    </div><div class="line">│  ├── tools     </div><div class="line">│  ├── .eslintrc.js </div><div class="line">│  ├── .eslintrc.json  </div><div class="line">│  ├── app.js     </div><div class="line">│  ├── config.js   </div><div class="line">│  ├── nodemon.json   </div><div class="line">│  ├── package.json    </div><div class="line">│  ├── process.prod.json   </div><div class="line">│  ├── qcloud.js   </div><div class="line">│  ├── README.md    </div><div class="line">│  ├── tools.md  </div><div class="line">├── src            // 前端源代码</div><div class="line">│  ├── components     </div><div class="line">│  ├── config    </div><div class="line">│  ├── mock     </div><div class="line">│  ├── pages     </div><div class="line">│  ├── styles     </div><div class="line">│  ├── utils       </div><div class="line">│  ├── App.vue        </div><div class="line">│  ├── main.js       </div><div class="line">│  ├── store.js      </div><div class="line">│  ├── weui.css    </div><div class="line">├── static          </div><div class="line">├── .babelrc         </div><div class="line">├── .editorconfig      </div><div class="line">├── .eslintignore    </div><div class="line">├── .eslintrc.js       </div><div class="line">├── .postcssrc.js      </div><div class="line">├── index.html        </div><div class="line">└── package.json      </div><div class="line">└── package-lock.json </div><div class="line">└── project.config.json </div><div class="line">└── README.md</div></pre></td></tr></table></figure>
<hr>
<h3 id="搭建后端本地开发环境"><a href="#搭建后端本地开发环境" class="headerlink" title="搭建后端本地开发环境"></a>搭建后端本地开发环境</h3><p>打开 server/config.js添加以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">const CONF = &#123;</div><div class="line">      // 其他配置 ...</div><div class="line">    serverHost: &apos;localhost&apos;,</div><div class="line">    tunnelServerUrl: &apos;&apos;,</div><div class="line">    tunnelSignatureKey: &apos;27fb7d1c161b7ca52d73cce0f1d833f9f5b5ec89&apos;,</div><div class="line">      // 腾讯云相关配置可以查看云 API 秘钥控制台：https://console.cloud.tencent.com/capi</div><div class="line">    qcloudAppId: &apos;您的腾讯云 AppID&apos;,</div><div class="line">    qcloudSecretId: &apos;您的腾讯云 SecretId&apos;,</div><div class="line">    qcloudSecretKey: &apos;您的腾讯云 SecretKey&apos;,</div><div class="line">    wxMessageToken: &apos;weixinmsgtoken&apos;,</div><div class="line">    networkTimeout: 30000</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>并修改 MySQL 相关的配置为本地的 MySQL 数据库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql: &#123;</div><div class="line">    host: &apos;localhost&apos;,</div><div class="line">    port: 3306,</div><div class="line">    user: &apos;root&apos;,</div><div class="line">    db: &apos;cAuth&apos;,</div><div class="line">    pass: &apos;******&apos;,</div><div class="line">    char: &apos;utf8mb4&apos;</div><div class="line">  &#125;,</div></pre></td></tr></table></figure>
<p>*切换到服务端代码目录<br>$cd server</p>
<p>*安装依赖<br>$npm install</p>
<p>*安装全局依赖<br>$npm install -g nodemon</p>
<p>$npm run dev</p>
<p>初始化数据库 - 打开 terminal 输入如下命令：</p>
<p>$node tools/initdb.js</p>
<p>进入Mysql选中刚才创建的数据库，输入 show tables; 可以看到初始化时创建了一个名叫 cSessionInfo 的表。说明本地环境已经搭建成功。</p>
<hr>
<h3 id="部署到腾讯云环境"><a href="#部署到腾讯云环境" class="headerlink" title="部署到腾讯云环境"></a>部署到腾讯云环境</h3><p>当本地本地开发出一版时，可以部署到腾讯云的开发环境，这样就可以在线上访问该项目。</p>
<p>首先修改项目根目录的 project.config.json 文件，添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;qcloudRoot&quot;: &quot;./server/&quot;,</div></pre></td></tr></table></figure>
<p>然后将本地开发时添加到 server/config.js 的配置删除，在 mysql.pass 那里填上自己的 APPID。</p>
<p>接着进入小程序开发工具，点击右上角的 腾讯云，上传测试代码，弹出如图选项。第一次部署如下选择，之后再次上传选择 智能上传 即可。部署成功会有提示。</p>
<p><img src="http://static.imkk.xin/blog/photo/uploadToTecentCloud.png" alt=""></p>
<hr>
<p>###上传前端代码</p>
<p>在小程序开发工具右上角找到 上传 选项，填写版本信息，上传后进入开发者控制台，开发管理页面，将该小程序设置为体验版本。</p>
<p>然后在用户身份 ==&gt; 成员管理中，添加项目成员，配置权限，这样好友也可以体验该小程序了。</p>
<p>项目地址：<a href="https://github.com/wangqian2017/mpvue-koa2" target="_blank" rel="external">https://github.com/wangqian2017/mpvue-koa2</a></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='https://link.hhtjim.com/kw/170.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>
